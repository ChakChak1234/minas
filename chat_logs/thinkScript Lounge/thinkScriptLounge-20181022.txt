------- Saturday, October 20, 2018 -------
15:45 Grasul: def LL = Lowest(low,9);
def NewLow = if low == LL then 1 else Double.NaN;
#def ReferenceHigh = if NewLow == 1 then high
#    else if high > ReferenceHigh then high 
#    else ReferenceHigh[1];
#def BullCounter = if NewLow == 1 then 0 
#    else if high > ReferenceHigh then BullCounter[1]+1 
#    else BullCounter[1];
15:46 Grasul: minus the commenting of course, I can't firgure out why ReferenceHigh doesn't ever seem to have a value
15:46 Grasul: if I plot ReferenceHigh I get nothing
15:47 JohnnyQuotron: But if you are like me and you look at Gaussian RSI Laguerre as the primary indicator but TMO and Gaussian SMA Crossovers then having a little quick and dirty profit calc on each lower study is reassuring.
15:56 Nube: grasul, make your reference high tow variables. The first being the high at the ll and the next being for highs above that. Doing that will let you see where the problem is.
15:56 Grasul: ok, thank you
15:58 JohnnyQuotron: trying to self-assign a non initialized rec...   do you have a little ! on your chart?
16:01 JohnnyQuotron: grasul.. please post the fix as I need to learn how to fix that error as well
16:09 Grasul: will do
16:30 amalia: Look at Renko study for example
16:41 MTS1: JQ; I think you can click on the ! to figure out the cause.
16:46 Grasul: I figured out my issue. The line that read def ReferenceHigh = if NewLow == 1 then 0 else if high > "ReferenceHigh" then high else ReferenceHigh[1];
16:47 Grasul: The ReferenceHigh in quotes needs to be ReferenceHigh[1], it can't test against itself, it needs to test against the previous bar
16:48 MTS1: makes sense; good feeling you found it right?
16:49 Grasul: I don't know about you guys, I consider myself pretty decent at logic chains, but in my coding, its almost always a logic issue
16:50 Grasul: (once you know the basic syntax)
16:50 Grasul: squishing bugs is always a good feeling past the initital frustration
16:50 MTS1: so it is for trading, plus human psycology..
16:51 MTS1: In scripting helps to know how to debug to see the values you're working with. Or breaking down statemetns smaller to see if the final statement is correct logic.
16:52 Grasul: yah, I code for at least part of my job for a living (though SQL, not this) so I get lots of practice squishing bugs.  The human part of trading, testing against yourself and figuring what makes yourself tick are for sure the interesting and challenging part.
16:54 Grasul: in this language, you do so much of the work in the variable definition, I think I'm just going to start by plotting almost all of my variables as I write the code and then remove the variable plots I don't care about once I'm sure they're getting the right answers.  It seems like the best way to debug.
16:56 MTS1: That probably gets cumbersome once you're somewhat familiar with the syntax, plus you cannot plot recursive variables that reference themselves. But yes that is the right way to debug; if there are many variables I'll debug a section at a time though. (and add plot statements for recursive variables that can easily be commented out again).
16:57 Grasul: that makes sense, I appreciate the help
16:57 MTS1: yw
17:21 amalia: yw
18:22 Vimes: re: gaps, someting i shared a few months ago to estimate fill % and stats, needs to be on a chart with extended hours hidden and the gap fill stats are based on teh first bar, so to estimate stats based on fill in the first 30mins set the chart to a 30min aggregation, the labels might need to be adjusted or split out for smaller screens
#vimes - gap stas - chat discussion 2018-07-12
#only evaulates the first opening bar so set the chart to desired period
# for evaulation of gap fills in the first opening range of the chart period

declare hide_on_daily;

input mingap = 6; #hint mingap: minimum gap to trade in pts (i.e identify gap trades of at least 6 /es pts or 10 /ym points)
input maxgap = 60;#hint maxgap: maxium gap to evaulate (filter to not analyze larger moves which might indicate  continuation
input usethreshold = yes;#hint usethreshold: apply threshold? yes will only consider gaps less than threshold; no will evaulate every gap

def o = if GetYYYYMMDD() > GetYYYYMMDD()[1] then open else o[1];
def c = if GetYYYYMMDD() > GetYYYYMMDD()[1] then close[1] else c[1];

#helper scripts
script retrace {
    input retrace_per = 0.5;
    input o = open;
    input c = close;
    def retracement = if o > c then o - (o - c) * retrace_per else o + (c - o) * retrace_per;
    plot retrace = retracement;
}

script guf {
    input Gap = 1;
    input tgt = close;
    plot guf = if Gap and low <= tgt then 1 else 0;
    plot percfill = totalsum(guf)/totalsum(gap)*100;
}
script gdf {
    input gap = 1;
    input tgt = close;
    plot gdf = if gap and high >= tgt then 1 else 0;
    plot percfill = totalsum(gdf)/totalsum(gap)*100;
}

script pts {
    input gf = 1;
    input tgt = close;
    plot pts = if gf and open > tgt then open - tgt else if gf and open < tgt then tgt - open else 0;
    def cnt = TotalSum(gf);
    plot totpts = totalsum(pts);
    plot avgpts = totpts / cnt;
    def exc = if gf and open > tgt then high - open else if gf and open < tgt then open - low else 0;
    plot avgexc = TotalSum(exc) / cnt;
    plot maxexc = highestAll(exc);

}
#retrace levels
plot retrace100 = retrace(1,o,c);
plot retrace75 = retrace(0.75,o,c);
plot retrace50 = retrace(0.5, o, c);
plot retrace25 = retrace(0.25, o, c);
def retrace10 = retrace(0.1,o,c);

def newday = GetYYYYMMDD() <> GetYYYYMMDD()[1] ; #only analyzing the first bar of the day based on the chart period
def GapUP = if o > c and newday and usethreshold and o-c>=mingap and o-c<=maxgap then 1
    else if o > c and newday and !usethreshold then 1 else 0;  
def GapDN = if o < c and newday and usethreshold and c-o>mingap and c-o<=maxgap then 1
    else if O < c and newday and !usethreshold then 1 else 0;

def cntGapUpDays = TotalSum(GapUP);
def cntGapDnDays = TotalSum(GapDN);
#50% retrace
#def guf50 = if GapUP and low <= retrace50 then 1 else 0;
def guf100 = guf(gapup,retrace100);
def guf75 = guf(gapup,retrace75);
def guf50 = guf(gapup,retrace50);
def guf25 = guf(gapup,retrace25);
def guf10 = guf(gapup,retrace10);

def gdf100 = gdf(gapdn,retrace100);
def gdf75 = gdf(gapdn,retrace75);
def gdf50 = gdf(gapdn,retrace50);
def gdf25 = gdf(gapdn,retrace25);
def gdf10 = gdf(gapdn,retrace10);

def pguf100 = guf(gapup,retrace100).percfill;
def pguf75 = guf(gapup,retrace75).percfill;
def pguf50 = guf(gapup,retrace50).percfill;
def pguf25 = guf(gapup,retrace25).percfill;

def pgdf100 = gdf(gapdn,retrace100).percfill;
def pgdf75 = gdf(gapdn,retrace75).percfill;
def pgdf50 = gdf(gapdn,retrace50).percfill;
def pgdf25 = gdf(gapdn,retrace25).percfill;

def ptsguf100 = pts(guf100, retrace100);
def totptsguf100 = pts(guf100, retrace100).totpts;
def avgptsguf100 = pts(guf100, retrace100).avgpts;
def avgexcguf100 = pts(guf100, retrace100).avgexc;
def maxexcguf100 = pts(guf100, retrace100).maxexc;

def ptsguf75 = pts(guf75, retrace75);
def totptsguf75 = pts(guf75, retrace75).totpts;
def avgptsguf75 = pts(guf75, retrace75).avgpts;
def avgexcguf75 = pts(guf75, retrace75).avgexc;
def maxexcguf75 = pts(guf75, retrace75).maxexc;

def ptsguf50 = pts(guf50, retrace50);
def totptsguf50 = pts(guf50, retrace50).totpts;
def avgptsguf50 = pts(guf50, retrace50).avgpts;
def avgexcguf50 = pts(guf50, retrace50).avgexc;
def maxexcguf50 = pts(guf50, retrace50).maxexc;

def ptsguf25 = pts(guf25, retrace25);
def totptsguf25 = pts(guf25, retrace25).totpts;
def avgptsguf25 = pts(guf25, retrace25).avgpts;
def avgexcguf25 = pts(guf25, retrace25).avgexc;
def maxexcguf25 = pts(guf25, retrace25).maxexc;

def ptsgdf100 = pts(gdf100, retrace100);
def totptsgdf100 = pts(gdf100, retrace100).totpts;
def avgptsgdf100 = pts(gdf100, retrace100).avgpts;
def avgexcgdf100 = pts(gdf100, retrace100).avgexc;
def maxexcgdf100 = pts(gdf100, retrace100).maxexc;

def ptsgdf75 = pts(gdf75, retrace75);
def totptsgdf75 = pts(gdf75, retrace75).totpts;
def avgptsgdf75 = pts(gdf75, retrace75).avgpts;
def avgexcgdf75 = pts(gdf75, retrace75).avgexc;
def maxexcgdf75 = pts(gdf75, retrace75).maxexc;

def ptsgdf50 = pts(gdf50, retrace50);
def totptsgdf50 = pts(gdf50, retrace50).totpts;
def avgptsgdf50 = pts(gdf50, retrace50).avgpts;
def avgexcgdf50 = pts(gdf50, retrace50).avgexc;
def maxexcgdf50 = pts(gdf50, retrace50).maxexc;


def ptsgdf25 = pts(gdf25, retrace25);
def totptsgdf25 = pts(gdf25, retrace25).totpts;
def avgptsgdf25 = pts(gdf25, retrace25).avgpts;
def avgexcgdf25 = pts(gdf25, retrace25).avgexc;
def maxexcgdf25 = pts(gdf25, retrace25).maxexc;


#check ladder to ladder as potential lower risk trade
def p10to25up = totalsum(guf25)/totalsum(guf10 or guf25)*100;
def p25to50up = totalsum(guf50)/totalsum(guf25 or guf50)*100;
def p50to75up = totalsum(guf75)/totalsum(guf50 or guf75)*100;
def p75to100up = totalsum(guf100)/totalsum(guf75 or guf100)*100;

def p10to25dn = totalsum(gdf25)/totalsum(gdf10 or gdf25)*100;
def p25to50dn = totalsum(gdf50)/totalsum(gdf25 or gdf50)*100;
def p50to75dn = totalsum(gdf75)/totalsum(gdf50 or gdf75)*100;
def p75to100dn = totalsum(gdf100)/totalsum(gdf75 or gdf100)*100;

def prof10to25dn = if gdf10 and gdf25 then retrace25-retrace10 else 0;
def prof25to50dn = if gdf25 and gdf50 then retrace50-retrace25 else 0;
def prof50to75dn = if gdf50 and gdf75 then retrace75-retrace50 else 0;
def prof75to100dn = if gdf75 and gdf100 then retrace100-retrace75 else 0;

def prof10to25up = if guf10 and guf25 then retrace10-retrace25 else 0;
def prof25to50up = if guf25 and guf50 then retrace25 - retrace50 else 0;
def prof50to75up = if guf50 and guf75 then retrace50 - retrace75 else 0;
def prof75to100up = if guf75 and guf100 then retrace75 - retrace100 else 0;

def c25u = totalsum(guf25);
def c50u = totalsum(guf50);
def c75u = totalsum(guf75);
def c100u = totalsum(guf100);

def ldr10to25up = totalsum(prof10to25up)/c25u;
def ldr25to50up = totalsum(prof25to50up)/c50u;
def ldr50to75up = totalsum(prof50to75up)/c75u;
def ldr75to100u = totalsum(prof75to100up)/c100u;

def c25d = totalsum(gdf25);
def c50d = totalsum(gdf50);
def c75d = totalsum(gdf75);
def c100d = totalsum(gdf100);

def ldr10to25dn = totalsum(prof10to25dn)/c25d;
def ldr25to50dn = totalsum(prof25to50dn)/c50d;
def ldr50to75dn = totalsum(prof50to75dn)/c75d;
def ldr75to100d = totalsum(prof75to100dn)/c100d;

addlabel(!usethreshold,"Considering all gaps at the open there are a total of up/down gaps =, "
  + astext(cntGapUpDays) + "/" +  astext(cntgapdndays)
    ,color.cyan);

addlabel(usethreshold,"Considering min/max gaps at the open of: " + astext(mingap) + "/" + astext(maxgap) 
    +", there are a total up/down gaps = " + astext(cntGapUpDays) + "/" +  astext(cntgapdndays)
    ,color.cyan);

AddLabel(yes, "Gap up and probability of 100/75/50/25% retrace on the first bar, "
    + astext(pguf100) + " / " + astext(pguf75) + " / " + astext(pguf50) +  " / " + astext(pguf25)
    + "%, Avg pts: " + AsText(avgptsguf100)  + " / " + AsText(avgptsguf75) + " / " + AsText(avgptsguf50) + " / " + AsText(avgptsguf25)
    + " Total pts: " + astext(totptsguf100) + " / " + astext(totptsguf75) + " / " + astext(totptsguf50) + " / " + astext(totptsguf25)
    + ", Avg negative excursion on winning trades: " + AsText(avgexcguf100) + "/" + AsText(avgexcguf75) + "/" + AsText(avgexcguf50) + "/" + AsText(avgexcguf25) 
    + ", Max Neg Excursion: " + AsText(maxexcguf100)
             , color = Color.yellow);

AddLabel(yes, "Gap down and probability of 100/75/50/25% retrace on first bar, "
    + astext(pgdf100) + " / " + astext(pgdf75) + " / " + astext(pgdf50) +  " / " + astext(pgdf25)
    + "%, Avg pts: " + AsText(avgptsgdf100)  + " / " + AsText(avgptsgdf75) + " / " + AsText(avgptsgdf50) + " / " + AsText(avgptsgdf25)
    + " Total pts: " + astext(totptsgdf100) + " / " + astext(totptsgdf75) + " / " + astext(totptsgdf50) + " / " + astext(totptsgdf25)
    + ", Avg negative excursion on winning trades: " + AsText(avgexcgdf100) + "/" + AsText(avgexcgdf75) + "/" + AsText(avgexcgdf50) + "/" + AsText(avgexcgdf25) 
    + ", Max Neg Excursion: " + AsText(maxexcgdf100)
             , color = Color.lime);

addlabel(yes,"Probability of 10/25, 25/50, 50/75, 75/100 ladder moves on a gap up (SELL): " 
    + astext(p10to25up) + "/" + astext(p25to50up) + "/" + astext(p50to75up) + "/" + astext(p75to100up) + "%"
    + ",AvgWin: " + astext(ldr10to25dn) + " / "+  astext(ldr25to50dn) + " / "+  astext(ldr50to75dn) + " / "+  astext(ldr75to100d)
,color.light_red);

addlabel(yes,"Probability of 10/25, 25/50, 50/75, 75/100 ladder moves on a gap down (BUY): " 
    + astext(p10to25dn) + "/" + astext(p25to50dn) + "/" + astext(p50to75dn) + "/" + astext(p75to100dn) + "%"
    + ",Avg win: " +  astext(ldr10to25up) + " / "+  astext(ldr25to50up) + " / "+  astext(ldr50to75up) + " / "+  astext(ldr75to100u) ,color.green);




18:42 UpTheCreek: guess that's what you call a simple script  ;)
18:51 cajun: Vimes, thankyou for post... interesting measures in there, like minimum negative excursion on winning trades.  i looked back at the july buffer you referenced, i see only few comments on gaps. 
18:51 cajun: could you say more about it
18:55 Vimes: That is the distance the bar went away from the target.  I can't see inside the 30min bar for example to say which occurs first but assumes you would have to sit through potentially that excusion to get the risk off on the target retracement level, it maybe gives some calibration for the amount of risk tolerance you would have to give
18:59 Vimes: to do something more precise we would have to build a shorter time frame study, say 5min cancles, and analyze the actual intraday bars, i wanted to avoid that so went with something that is more of a guide
19:04 cajun: yep... a conservative eastimate.. sounds like then a worst case estimate?... since youre using the full length of the excursion .   and that means " avg win"  is a conservative underestimate of the same propirtion? 
19:06 Vimes: yes that is only the amount of positive expectancy on each ladder doesn't not net out a stop loss or whatever
19:09 cajun: im awed by the systematized step by step calculations .. will take me alot more code learning to fully understand.   seems like the math should be useful for extracting to other estimates.  nice work
19:15 Vimes: well thanks, not a coder, but can fake it every now and then
19:19 cajun: ha!
19:19 cajun: g.n. folks! all sweet dreams
19:21 Brad952: gn
19:22 MTS1: thanks TCuls!
19:23 Nube: Nice work, Vimes!
19:23 Vimes: ty
19:25 Vimes: Some typical observations on gap fills, i usually when you start to retrace to certain levels the probabiliy improves that you will close the full gap, this is similar to background on pivot points as well, this doesn't mean price has to do anything but just to be aware that once gaps start to retrace, there is positive expactancy that they will continue, so combined with other indicators can give some good trades, some also look at market internals at the open, tick, volume etc. to further screen gap fills
19:25 MTS1: a little long to read on my phone;) will check it out though, thanks for sharing!
19:26 slashgw: here is another study for gap fills if you have interest to check it out.  I did not write it.  it is from BigWaveDave http://tos.mx/uJmNWN#
19:27 MTS1: if it does not retrace though Vimes, higher possibility of a trend day for example
19:29 slashgw: it can be a trend day, till it turns and fills the gap ;)
19:30 MTS1: trend days oscillators don't work well & you should just get in when it pulls back to ma or trend line
19:31 slashgw: gap fill level is often a good entry location after it fills
19:32 slashgw: even if not on the same day
19:33 Vimes: Yes there are some theories that all gaps eventually fill with some high probability, but i have no data on that
19:33 slashgw: https://screencast.com/t/JfV5FBouM
19:34 slashgw: and the next one to look at on ES should be in the 2753 area
19:35 MTS1: I can see it's a natural SR level cuz people wish they bought at that point, jumping in when it gets back to that level
19:35 MTS1: *SR area
19:36 slashgw: https://screencast.com/t/3YqKK7TleIdJ
19:37 slashgw: well, imo, it's because of not getting left behind.
19:37 Vimes: that's the study you shared last week?
19:37 Vimes: or so
19:38 slashgw: the one in screencast  just showing the horizontal purple lines, yes.
19:39 slashgw: http://tos.mx/fubvrS#
19:40 Vimes: thx
19:42 G3_: nice charting slashgw
19:43 slashgw: with regard to ES, any gap greater than 10 points in either direction is considered a "pro gap & go", so odds are obviously much less to immediately fill.  then tend to just keep trading away, but when a trading setup does break, then typically the gap level will become the target.  But within that 10 point or less gap, odds of gapfill can be quite good.  as always, anything is possible though.
19:43 slashgw: thanks G3
19:46 Vimes: There was a trade setup proposed by noble, that related to overnight trade that exceeded the maintenance margin, the idea if the gap was that large folks woudl immediately cover causing a short burst of trade continuing
19:46 slashgw: ah, interesting theory.  thanks.
19:48 Ariana3: I've heard about a maintenance margin strategy before. Sounds interesting, do you guys have a strategy or an indicator for it?
19:49 G3_: a 10 point + gap?
19:50 G3_: seems it would have to be +15 to rattle thoses cages.
19:51 Ariana3: Yes, by Noble in a book The Trader's Edge, that is where I've read it.
19:51 Vimes: you would have to look at the contract specs, i think its something like 22 points on nq
19:51 Vimes: ^arana correct
19:51 G3_: I was referring to /es
19:51 Nube: 5000 worth of gap seems like it might be enough to spook margins and blow through a ot of stops so I can believe that
19:52 Nube: Traders are concerned, price continues because of covering and they bail out. Can see it.
19:52 Nube: arithmetic was never my strong suit
19:53 Nube: or reading or writing
19:53 slashgw: yeah, can def see it.  just never thought about it from that perspective.  always looked at it from a FOMO perspective.
19:53 slashgw: napping is my strong suit
19:53 slashgw: oh, and recess
19:54 Nube: Now we gotta make an overnight margin trouble script
19:54 slashgw: that could become an important one soon :)
19:55 Ariana3: He calls it "the Initial-Maintenance Opening Rule"
19:56 Vimes: i can't find my book, so don't recall the full details
19:56 Vimes: i think its the delta between the initial and maintenacne margin
19:56 Vimes: which maybe could vary by futures broker
19:56 Ariana3: I have it, hold on
19:57 G3_: when and if margin req are raised.  They are sure as hell not going to be lowered anytime soon. fwiw
19:58 Vimes: i recall the language in teh book being kind of murky, it was a bit dated
19:58 Ariana3: https://www.screencast.com/t/l7tiQglmX1
20:00 admin_tculs: gn all
20:00 Vimes: gn
20:00 G3_: good eve tculs
20:00 G3_: and all
20:00 Ariana3: gn TC
20:00 slashgw: gn tculs & all
------- Monday, October 22, 2018 -------
05:44 Lippy1m: Hello I am looking to do a simple scan with the relative strength of a stock crossing below the SPX and although I can get that to show up on my charts, I am having a hard time configuring a scan for the same.  Can anybody help me out please?
07:14 chief: Lippy, try this...note that I am not a scripter...
input length = 63;
def IWMPctChg = (close( period = "Day") / close( period = "Day")[length]) - 1;


def SPYPctChg = (close("SPY", period = "Day") / close("SPY", period = "Day")[length]) - 1;

def rs =  100*(IWMPctChg - SPYPctChg);

def rsSPX = rs;
#plot crossup = rs>0 and rs[1]<0;
plot crossdn = rs<0 and rs[1]>0;

07:15 chief: Wait, cannot have sec aggs in scan
07:16 chief: Try this....
input length = 63;
def IWMPctChg = (close / close[length]) - 1;


def SPYPctChg = (close("SPY") / close("SPY")[length]) - 1;

def rs =  100*(IWMPctChg - SPYPctChg);

def rsSPX = rs;
#plot crossup = rs>0 and rs[1]<0;
plot crossdn = rs<0 and rs[1]>0;
07:45 chief: One last time hopefully...
input length = 63;
def  PctChg = (close / close[length]) - 1;


def SPYPctChg = (close("SPY") / close("SPY")[length]) - 1;

def rs =  100*(PctChg - SPYPctChg);

def rsSPX = rs;
#plot crossup = rs>0 and rs[1]<0;
plot crossdn = rs<0 and rs[1]>0;
07:47 JohnnyQuotron: Good morning thinkScript Lounge.
07:55 chief: GM, I think I scared Lippy away ,lol. I think TDA reports today
08:02 tarbog: hello, i have a simple script to draw the days mid point that just shows a horizontal line that move as new highs and lows are made.� how would i add a time factor to it to make it more like the vwap or a moving average that would track the mid point of the day to that time and leave that plot there and adjust through out the day so you could see where the mid point of the day was at any time of the day.    
08:08 Mobius: get the barNumber() at time and hold that value as the plot
08:12 Mobius: Example:

def time = if SecondsTillTime(0930) == 0
                  then barNumber()
                 else double.nan;
def price = if !isNaN(time)
                   then hl2
                  else price[1];
plot lineAtTime = if barNumber() >= HighestAll(time)
                              then highestAll(if isNaN(close[-1])
                                                        then price
                                                        else double.nan)
                             else double.nan;
08:13 Mobius: For more examples go to Mobius on MyTrade
08:13 chief: There is a built in study HighLowMA that may work for you also
08:13 chief: Midle high low MA
08:15 Mobius: +1% Globex range with avg volume. Should be a good trading range today.
08:16 Mobius: BTW -  Good morning all
08:16 UpTheCreek: GM
08:16 DMonkey: morning....
08:17 Mobius: Feel like Mr Rogers this morning. It's a beautiful day in the neighborhood
08:17 DMonkey: ###   tarbog chat request   ###
###   Chat Request Highest High RTH // Lowest Low RTH   ###
###   DMonkey 11/12/2016   ###
###   Plots from Market Open to Market Close   ###
input market_open = 0930;
def   h = high;
def l = low;
input Duration_In_Hours = 6.5;
def   Market_Duration = Duration_In_Hours * 60 * 60; 
def   Go_Time = secondsFromTime(market_open);
def   openhigh = if Go_Time == 0 
                 then h
                 else if h > openhigh[1]
                 then h
                 else openhigh[1];

plot   data =    
                 if Go_Time >= 0 
                 && go_Time <= market_Duration
                 then highestall(if isnan(close[-1]) then openhigh else double.nan)
                 else double.nan;
data.setpaintingStrategy(PaintingStrategy.DASHES);
data.setdefaultColor(Color.YELLOW);
data.setlineWeight(3);

def openlow = if Go_Time == 0
              then l
              else if  l < openlow[1]
              then l
              else openlow[1];

plot data2 =     if Go_Time >= 0 
                 && go_Time <= market_Duration
                 then highestall(if isnan(close[-1]) then openlow else double.nan)
                 else double.nan
                ;
data2.setpaintingStrategy(PaintingStrategy.DASHES);
data2.setdefaultColor(Color.MAGENTA);
data2.setlineWeight(3);

###   Added Alerts // Chat Room Request ###
###   7/20/2017   ###
alert(high > openhigh[1],"New Intraday High", Alert.BAR, Sound.Ring);
alert(low < openlow[1],"New Intraday Low", Alert.BAR, Sound.Bell);
###   10.22.2018   ###
###   Chat Request Tarbog   ###
###   Added HL2   ###
plot mid = (openhigh + openlow) * .5;
mid.setpaintingStrategy(paintingStrategy.POINTS);
mid.setdefaultColor(color.cyan);
###   End Code   ##
08:18 DMonkey: are you changing into your sweater?
08:21 Mobius: Just about cool enough for one  :)
08:27 tarbog: thanks guys.  
08:28 trendman: GM all
08:29 trendman: Stuck on a scan writing SMA 1 > SMA 2 by $2.00.  Any thoughts?
08:31 DMonkey: sma1 - sma2 > 2
08:31 DMonkey: assuming you defined your sma's....
08:33 trendman: yes, I have defined the SMA
08:37 trendman: I was trying to get fancy.  Simple works thanks.  Feel silly now!
08:42 UpTheCreek: well to get fancy sma1 > sma2 + 2
08:44 DMonkey: sma2 + 2 < sma1
09:12 Mobius: Bounced right off the lower reach of the implied move. Now it's time to fish or cut bait
09:27 randykreisel: Help with conditional orders.  I would like to test two conditions with AND.  All my reading says the order wizard only handles OR.  Help Please
09:28 Vimes: Mobius, i'm not getting the implied probable moves to plot today on /es, has worked like a charm in days past, is there something wrong?
09:29 AlphaInvestor: Vimes - likely the symbol change messing with you
09:30 Vimes: well it worked fin last week with the prior update
09:30 Mobius: The study is working fine.
09:30 Vimes: must be a data feed problem
09:33 Vimes: figured it out, i only had it on my 15min chart which i had changed over the weekend to hide ext hours - pbkac error
09:45 Vimes: ping pong
09:57 Nube: Alpha did a momersion study and it got me looking for ways to determine market regimes. One of the places I looked was comparing an ETF price to it's asset value using the .NV ticker symbol. It's late to the party but in case it's useful for ETF buyers / traders
09:57 Nube: 
# Discount or Premium to Net Asset Value
#be sure to use .nv
# Nube 10.21.18
declare lower;
    #inputs
input netAssetValue = "SPY.NV";
    #variables
def c = close;
def nav = close(netAssetValue);
def discount = nav - c;
    #plots
plot 
discountToNetAssetValue = discount;
discountToNetAssetValue.AssignValueColor(if   discount < 0
                                         then Color.DownTick
                                         else Color.UpTick);
AddChartBubble(!IsNaN(c) and IsNaN(c[-1]), discount,
""+GetSymbol()+" disount or premium \nto "+netAssetValue+": "+discount, 
if discount < 0 then Color.DownTick else Color.UpTick, discount > 0);
09:58 Nube: Now we need on the masters to show us how to manipulate the string so get it to pull the .NV ticker automatically
10:03 AlphaInvestor: Nuibe - string concatonation is easy peasy - it is pulling them apart that is impossible
10:05 Nube: def test = close(GetSymbol()+".NV");
10:05 Nube: I should have given it one more shot before giving up
10:07 John1a: When VWAP does not open with the price, is this a bug in TOS? https://www.screencast.com/t/sils0LXI
10:08 Nube: New and Improved
# Discount or Premium to Net Asset Value
#be sure to use .nv
# Nube 10.21.18
declare lower;
    #variables
def c = close;
def nav = close(GetSymbol()+".NV");
def discount = nav - c;
    #plots
plot 
discountToNetAssetValue = discount;
discountToNetAssetValue.SetDefaultColor(Color.Gray);
discountToNetAssetValue.AssignValueColor(if   discount < 0
                                         then Color.DownTick
                                         else Color.UpTick);
AddChartBubble(!IsNaN(c) and IsNaN(c[-1]), discount,
""+GetSymbol()+" disount to\n"+GetSymbol()+".NV: "+discount, 
if discount < 0 then Color.DownTick else Color.UpTick, discount > 0);
10:09 AlphaInvestor: der we go
10:09 John1a: "Normal" VWAP open: https://www.screencast.com/t/rHD5u6q561bG
10:10 MTS1: John; is that the built-in VWAP? Does not look like it.
10:11 John1a: MTS1: Yes, built-in, I just did not plot STD bands, just the VWAP
10:12 John1a: The dashed horizontal line is the built-in VWAP
10:13 Vimes: what are you plotting, i don't see that on my charts
10:13 MTS1: have not seen it behave like that John
10:14 John1a: Does not happen often, but if you do , for example, 60 days, 15 minutes on ES or RTY and scroll to the left, you will see a number of days when it did that
10:17 Vimes: sorry, i don't see that
10:19 MTS1: Looks like hte VWAP script uses the VWAP fundamental price value; if you're seeing the wrong 'price' or vwap value it may be a data feed issue on those time aggregations; not sure what days you see them on, are they holidays or other weird gaps?
10:19 John1a: Here is an exa ple on ES, starting on 09/10/18: https://www.screencast.com/t/qBFpFPnYug
10:19 MTS1: (uses VWAP and Volume)
10:23 Vimes: uncheck adjust for contract changes
10:23 John1a: ITt goes way back, for example, from 08/02/18, past 09/10/18 every day overnight open was like that
10:23 Vimes: or plot the exact contract
10:24 Nube: post the script, John1a
10:25 AlphaInvestor: undoubtedly PEBKAC error
10:25 John1a: Vimes: Interesting, unchecking fixed it, but isn't suppose to work with a continues contract?
10:26 John1a: Nube: It is a VWA which is in TOS
10:26 AlphaInvestor: is Start Aggregaion at Market Open checked?
10:26 John1a: VWAP
10:26 Vimes: its something you will never see in real time imo, its only in trying to back correct teh continuous contract, don't know the math behind how they do this
10:26 John1a: Alpha: No
10:27 DMonkey: John. Just write your own and initialize from your starting bar. Vwap isn’t hard to calculate.
10:27 MTS1: I can't replicate it on those dates / times; try it on a different computer John
10:27 Vimes: they are at minimum two instruments they are trying to blend together so maybe not so easy to make it look seamless
10:28 Nube: John, what time frame do you ahve selected?
10:28 John1a: If I uncheck "Adjust for contract changes" it snaps to the Globex open bar and looks correct
10:29 John1a: Nube: 15 minutes
10:30 Nube: No tchart aggregation. What time frame do oyu have selected in thte study input?
10:30 AlphaInvestor: he has DAY selected
10:30 Nube: I suspect you have day but want something else
10:31 John1a: Yes, day, no that is what I wanted, Day VWAP that starts at the session open (Globex) and goes till the end of the RTH
10:32 Nube: You don't get a choice in what time or price it begins calculating at, If you want that you would need to write your own as mentioned by DMonkey above.
10:33 John1a: What do you mean? Day starts at the rollover line on ES, RTY, etc
10:34 John1a: If I want it to always start at the rollover line I need to write my own?
10:35 Nube: I don't know what the study you have up is calculating from and neither do you. Write your own, be sure
10:37 Vimes: i may no t know either but seems like the solution is to uncheck adjust for contract changes, maybe i'm not seeing what you are seeing
10:37 John1a: I don't know how to write my own, but I have this
10:37 John1a: #
# TD Ameritrade IP Company, Inc. (c) 2011-2018
#

input numDevDn = -2.0;
input numDevUp = 2.0;
input timeFrame = {default DAY, WEEK, MONTH};

def cap = getAggregationPeriod();
def errorInAggregation =
    timeFrame == timeFrame.DAY and cap >= AggregationPeriod.WEEK or
    timeFrame == timeFrame.WEEK and cap >= AggregationPeriod.MONTH;
assert(!errorInAggregation, "timeFrame should be not less than current chart aggregation period");

def yyyyMmDd = getYyyyMmDd();
def periodIndx;
switch (timeFrame) {
case DAY:
    periodIndx = yyyyMmDd;
case WEEK:
    periodIndx = Floor((daysFromDate(first(yyyyMmDd)) + getDayOfWeek(first(yyyyMmDd))) / 7);
case MONTH:
    periodIndx = roundDown(yyyyMmDd / 100, 0);
}
def isPeriodRolled = compoundValue(1, periodIndx != periodIndx[1], yes);

def volumeSum;
def volumeVwapSum;
def volumeVwap2Sum;

if (isPeriodRolled) {
    volumeSum = volume;
    volumeVwapSum = volume * vwap;
    volumeVwap2Sum = volume * Sqr(vwap);
} else {
    volumeSum = compoundValue(1, volumeSum[1] + volume, volume);
    volumeVwapSum = compoundValue(1, volumeVwapSum[1] + volume * vwap, volume * vwap);
    volumeVwap2Sum = compoundValue(1, volumeVwap2Sum[1] + volume * Sqr(vwap), volume * Sqr(vwap));
}
def price = volumeVwapSum / volumeSum;
def deviation = Sqrt(Max(volumeVwap2Sum / volumeSum - Sqr(price), 0));

plot VWAP = price;
plot UpperBand = price + numDevUp * deviation;
plot LowerBand = price + numDevDn * deviation;

VWAP.setDefaultColor(getColor(0));
UpperBand.setDefaultColor(getColor(2));
LowerBand.setDefaultColor(getColor(4));
10:38 John1a: How would I write my own differently, the code above is from TOS
10:38 Nube: Try pasting that into a new study. Nobody can duplicate your problem using the stock study. IF the problem persists, contact ToS and let them know about it
10:40 John1a: If you have Adjust for contract changes checked, you don't see the same thing on ES on 09/10/18?
10:41 Vimes: i do not
10:42 John1a: Oh, ok, got it. I'll contact support. Thank you all.
10:43 Vimes: but unless you are doing some kind of backtesting who cares, teh current vwap will be on the actie contract
10:45 John1a: Vimes: Yes, I am doing some backtesting
10:46 JoshuaK: i have a question regarding how TOS references values from studies
10:46 John1a: How do I force it to start at the rollover line? Without unchecking "Adjust for contract changes" ?
10:47 Vimes: 9/10 per your request - i don't see the issue
 
10:47 JoshuaK: so lets say i go to Marketwatch>Quotes>customize the tool bar so that it has open close VWAP
10:47 JoshuaK: the VWAP is close study that has plots
10:47 JoshuaK: how does the column know to reference the specific value in the study called VWAP
10:47 John1a: Vimes: Do you have overnight displayed and Adjust for contract changes checked?
10:48 JoshuaK: the reason i ask because i have someself defined studies, and im  tryingto display only the values, but the study itself plots things. Im just trying to extract the value itself, and display it in a column
10:49 JohnnyQuotron: The LoungeArchive is current.
